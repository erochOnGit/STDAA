/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var m=Object.create;var g=Object.defineProperty;var v=Object.getOwnPropertyDescriptor;var w=Object.getOwnPropertyNames;var P=Object.getPrototypeOf,E=Object.prototype.hasOwnProperty;var T=(o,a)=>{for(var t in a)g(o,t,{get:a[t],enumerable:!0})},h=(o,a,t,r)=>{if(a&&typeof a=="object"||typeof a=="function")for(let e of w(a))!E.call(o,e)&&e!==t&&g(o,e,{get:()=>a[e],enumerable:!(r=v(a,e))||r.enumerable});return o};var k=(o,a,t)=>(t=o!=null?m(P(o)):{},h(a||!o||!o.__esModule?g(t,"default",{value:o,enumerable:!0}):t,o)),b=o=>h(g({},"__esModule",{value:!0}),o);var R={};T(R,{default:()=>p});module.exports=b(R);var u=k(require("path")),f=require("obsidian"),p=class extends f.Plugin{constructor(){super(...arguments);this.cursorPos=null}async onload(){console.log("format on drop unable"),this.registerDomEvent(document,"dragover",t=>{let r=t.target,e=this.getEditorFromTarget(r);if(e){let n=e.cm,{clientX:i,clientY:c}=t;if(!e.containerEl)return null;let s=n.posAtCoords({x:i,y:c});e.focus(),this.cursorPos=e.offsetToPos(s)}}),this.registerDomEvent(document,"drop",t=>{var n;t.preventDefault(),t.stopImmediatePropagation();let r=t.target,e=(n=t.dataTransfer)==null?void 0:n.getData("text");if(e){let i="",c=this.getObsidianUrl(r);if(c){let s=this.extractRelativePath(c),d=this.extractRelativePath(e);s&&d&&(i=`![Image](${this.getRelativePath(s,d)})`)}let l=this.getEditorFromTarget(r);if(l){let s={line:0,ch:0};this.cursorPos?s=this.cursorPos:s=l.getCursor(),l.replaceRange(i,s),setTimeout(()=>{l.focus(),l.setCursor({line:s.line,ch:s.ch+i.length})},500)}else console.warn("No editor found for target element.")}else console.warn("No text found in drop event.")},!0)}onunload(){console.log("Plugin unloaded")}getEditorFromTarget(t){for(let r of this.app.workspace.getLeavesOfType("markdown")){let e=r.view,n=e.editor;if(e.containerEl.contains(t))return n}return null}getAbsolutePath(t){for(let r of this.app.workspace.getLeavesOfType("markdown")){let e=r.view,n=this.app.workspace.getActiveFile();if(n)return this.app.vault.getResourcePath(n)}return null}getObsidianUrl(t){for(let r of this.app.workspace.getLeavesOfType("markdown")){let e=r.view,n=this.app.workspace.getActiveFile();if(n){let i=this.app.vault.getName(),c=n.path;return`obsidian://open?vault=${encodeURIComponent(i)}&file=${encodeURIComponent(c)}`}}return null}extractRelativePath(t){return new URL(t).searchParams.get("file")}getRelativePath(t,r){let e=u.dirname(t);return u.relative(e,r).split(u.sep).join("/").replace(/ /g,"%20")}formatDroppedText(t){if(t.startsWith("obsidian://open?vault="))try{let r=new URL(t);return`![Image](${decodeURIComponent(r.searchParams.get("file")||"")})`}catch(r){return console.error("Error parsing dropped text:",r),t}return t}};
